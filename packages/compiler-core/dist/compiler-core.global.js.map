{
  "version": 3,
  "sources": ["../src/index.ts"],
  "sourcesContent": ["import { NodeTypes } from \"./ast\"\n\nfunction createParserContext(template) {\n    return {\n        line: 1,\n        column: 1,\n        offset: 0,\n        source: template,\n        originSource: template\n    }\n}\n\nfunction isEnd(context) {\n    return !context.source.length\n}\n\nfunction getCursor(context) {\n    return {\n        line: context.line,\n        column: context.column,\n        offset: context.offset\n    }\n}\n\nfunction advancePositionWithMutation(context, source, endIndex) {\n    // \u6362\u884C\u7B26\u7684\u4E2A\u6570\n    let lineCount = 0\n    // \u6700\u540E\u4E00\u4E2A\u6362\u884C\u7B26\u7684\u4F4D\u7F6E\n    let linePos = -1\n    for (let i = 0; i < endIndex; i++) {\n        if (source.charCodeAt(i) === 10) {\n            lineCount ++\n            linePos = i\n        }\n    }\n    context.line += lineCount\n    context.offset += endIndex\n    context.column = linePos === -1 ? context.column + endIndex : endIndex - linePos\n}\n\nfunction advanceBy(context, endIndex) {\n    const resource = context.source\n    // \u6BCF\u6B21\u5220\u6389\u5185\u5BB9\u7684\u65F6\u5019 \u90FD\u8981\u66F4\u65B0\u6700\u65B0\u7684\u884C\u5217\u548C\u504F\u79FB\u91CF\u4FE1\u606F\n    advancePositionWithMutation(context, resource, endIndex)\n    context.source = context.source.slice(endIndex)\n}\n\nfunction parseTextData(context, endIndex) {\n    const rawText  = context.source.slice(0, endIndex)\n    advanceBy(context, endIndex)\n    return rawText\n}\n\nfunction getSelection(context, start, end?) {\n    end = end ? end : getCursor(context)\n    return {\n        start,\n        end,\n        source: context.originSource.slice(start.offset, end.offset)\n    }\n    \n}\n\nfunction parseText(context) {\n    const endTokens = ['<', '{{']\n\n    let endIndex = context.source.length\n    for (let i = 0; i < endTokens.length; i++) {\n        const index = context.source.indexOf(endTokens[i])\n        if (index !== -1 && endIndex > index) {\n            endIndex = index\n        }\n    }\n    // \u521B\u5EFA\u884C\u5217\u4FE1\u606F \u7528\u6765\u62A5\u9519\u7528\n    const start = getCursor(context)\n\n    // \u83B7\u53D6\u5185\u5BB9\n    const content = parseTextData(context, endIndex)\n\n\n    // \u8FD4\u56DE\u6587\u672C\u8282\u70B9\u4FE1\u606F\n    return {\n        type: NodeTypes.TEXT,\n        content,\n        loc: getSelection(context, start)\n    }\n}\n\n\nfunction parseInterpolation(context){ // \u5904\u7406\u8868\u8FBE\u5F0F\u7684\u4FE1\u606F \n    const start = getCursor(context); // xxx  }}\n    const closeIndex = context.source.indexOf('}}',2); // \u67E5\u627E\u7ED3\u675F\u7684\u5927\u62EC\u53F7\n    advanceBy(context,2); // {{  xx }}\n    const innerStart = getCursor(context);\n    const innerEnd = getCursor(context); // advancePositionWithMutation\n\n    // \u62FF\u5230\u539F\u59CB\u7684\u5185\u5BB9 \n    const rawContentLength = closeIndex - 2; // \u539F\u59CB\u5185\u5BB9\u7684\u957F\u5EA6\n    let  preContent = parseTextData(context,rawContentLength); // \u53EF\u4EE5\u8FD4\u56DE\u6587\u672C\u5185\u5BB9\uFF0C\u662F\u5E76\u4E14\u53EF\u4EE5\u66F4\u65B0\u4FE1\u606F\n    let content = preContent.trim();\n    let startOffset = preContent.indexOf(content)//   {{  xxxx}}\n\n    if(startOffset > 0){\n        advancePositionWithMutation(innerStart,preContent,startOffset)\n    }\n    let endOffset = startOffset + content.length\n    advancePositionWithMutation(innerEnd,preContent,endOffset)\n    advanceBy(context,2);\n    return {\n        type:NodeTypes.INTERPOLATION, // \u8868\u8FBE\u5F0F\n        content:{\n            type:NodeTypes.SIMPLE_EXPRESSION,\n            content,\n            loc:getSelection(context,innerStart,innerEnd)\n        },\n        loc:getSelection(context,start) // \u8868\u8FBE\u5F0F\u76F8\u5173\u7684\u4FE1\u606F\n    }\n}\n\n\nfunction advanceSpace(context) {\n    const spaces = /^\\s*/.exec(context.source)\n    advanceBy(context, spaces[0].length)\n}\n\nfunction parseAttributeValue(context) {\n    const start = getCursor(context);\n    const matched = /^([^\\s=/>]+)/.exec(context.source)\n    const content = matched[0]\n    advanceBy(context, content.length)\n\n    advanceSpace(context)\n\n    return {\n        content,\n        loc: getSelection(context, start)\n    }\n}\n\nfunction parseAttribute(context) {\n    const start = getCursor(context);\n    const matched = /^([^\\s=/>]+)/.exec(context.source)\n    const attributeName = matched[0]\n    advanceBy(context, attributeName.length)\n    advanceSpace(context)\n    advanceBy(context, 1); // \u53BB\u6389=\n    const value = parseAttributeValue(context);\n    \n    return {\n        type: NodeTypes.ATTRIBUTE,\n        name: attributeName,\n        value: {\n            type: NodeTypes.TEXT,\n            ...value\n        },\n        loc: getSelection(context, start)\n    }\n}\n\nfunction parseAttributes(context) {\n    const props = []\n    while (context.source.length && context.source[0] !== '>') {\n        const prop = parseAttribute(context)\n        props.push(prop)\n    }\n    return props\n}\n\nfunction parseTag(context) {\n    const start = getCursor(context)\n    const matched = /^<\\/?([a-z][^\\s\\/>]*)/.exec(context.source)\n    const tag = matched[1]\n    advanceBy(context, matched[0].length)\n    // \u53BB\u9664\u7A7A\u683C\n    advanceSpace(context)\n    const props = parseAttributes(context)\n    advanceSpace(context)\n    advanceBy(context, 1) // \u53BB\u6389>\n    return {\n        type: NodeTypes.ELEMENT,\n        props,\n        tag,\n        loc: getSelection(context, start),\n        children: []\n    }\n}\n\nfunction parseChildren(context) {\n    let nodes = []\n\n    while(!isEnd(context)) {\n        const source = context.source\n        let node\n\n        if (source.startsWith('{{')) {\n            node = parseInterpolation(context)\n        } else if (source.startsWith('<')) { // \u6807\u7B7Ek\n            node = parseElement(context);\n        }\n        if (!node) {\n            // \u6587\u672C\n            node = parseText(context)\n        }\n\n        nodes.push(node)\n        break\n    }\n\n    return nodes;\n}\n\nfunction parseElement(context) {\n   const ele = parseTag(context)\n   const children = parseChildren(context)\n   if (context.startsWith('</')) {\n       parseTag(context)\n   }\n\n    ele.children = children;\n\n    ele.loc = getSelection(context, ele.loc.start)\n\n    return ele;\n}\n\nfunction parse(template) {\n    // \u521B\u5EFA\u4E00\u4E2A\u89E3\u6790\u4E0A\u4E0B\u6587\u6765\u8FDB\u884C\u5904\u7406\n    const context = createParserContext(template)\n\n    return parseChildren(context)\n   \n}\n\nexport function compile(template) {\n    const templateAST = parse(template)\n\n    console.log('ast', templateAST)\n\n    // const jsAST = transform(templateAST)\n}\n"],
  "mappings": "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",
  "names": []
}
