{
  "version": 3,
  "sources": ["../src/index.ts", "../src/effect.ts", "../src/reactive.ts"],
  "sourcesContent": ["export * from './reactive'\nexport * from './effect'", "export let activeEffect: ReactiveEffect\n\nexport class ReactiveEffect {\n    parent: ReactiveEffect | undefined = undefined\n    active = true\n    deps: any = [] //? \u7C7B\u578B\u95EE\u9898\n    constructor(public fn: Function, public scheduler: () => void) {}\n\n\n    run() {\n        if (!this.active) return this.fn()\n        this.active = true; // ?\n        this.parent = activeEffect\n        activeEffect = this\n        // \u5206\u4E4B\u5207\u6362\n        cleanupEffect(this)\n        const v = this.fn()\n        activeEffect = this.parent\n        return v;\n    }\n\n    stop() {\n        this.active = false;\n        cleanupEffect(this)   \n    }\n}\n\nfunction cleanupEffect(effect: ReactiveEffect) {\n    effect.deps.forEach((dep: Set<ReactiveEffect>) => {\n        dep.delete(effect)\n    })\n    effect.deps.length = 0\n}\n\n\nexport function effect(fn: Function, options: Record<string, any> = {}) {\n    const _effect = new ReactiveEffect(fn, options.scheduler)   \n    _effect.run()\n    const runner: any = _effect.run.bind(_effect)\n    runner.effect = _effect\n    return runner\n}", "import { activeEffect, ReactiveEffect } from \"./effect\";\n\nconst cache = new WeakMap()\nexport function reactive(target: Record<string, any>) {\n    if (cache.get(target)) return cache.get(target)\n\n    if (target.is_reactive) {\n        // \u68C0\u6D4B\u4F20\u8FDB\u6765\u7684\u662F\u4E0D\u662F\u4EE3\u7406\u5BF9\u8C61\n        return target\n    }\n\n    const proxy = new Proxy(target, {\n        get(target, key, recevier) {\n            if (key === 'is_reactive') {\n                return true;\n            }\n            track(target, key)\n            return Reflect.get(target, key, recevier)\n        },\n        set(target, key, value, recevier) {\n            let rs = Reflect.set(target, key, value, recevier)\n            trigger(target, key) // ? trigger\u7684\u987A\u5E8F\n            return rs;\n\n        }\n    })\n\n    cache.set(target, proxy)\n\n    return proxy;\n}\n\nconst map = new WeakMap()\nfunction track(target: Record<string, any>, key: string | symbol) {\n    let depMap = map.get(target)\n    if (!depMap) {\n        map.set(target, depMap = new Map())\n    }\n\n    let deps = depMap.get(key)\n    if (!deps) {\n        depMap.set(key, deps = new Set())\n    }\n\n    if (!deps.has(activeEffect)) {\n        deps.add(activeEffect)\n    }\n    activeEffect && activeEffect.deps.push(deps)\n\n}\n\n\nfunction trigger(target: Record<string, any>, key: string | symbol) {\n    const depMap = map.get(target)\n    if (!depMap) return\n    const deps = depMap.get(key)\n    if (!deps) return\n    new Set(deps).forEach((dep: any) => {\n        if (dep.scheduler) {\n            dep.scheduler()\n        } else {\n            dep.run()            \n        }\n    })\n\n}"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACAO,MAAI;AAEJ,6BAAqB;AAAA,IAIxB,YAAmB,IAAqB,WAAuB;AAA5C;AAAqB;AAHxC,oBAAqC;AACrC,oBAAS;AACT,kBAAY,CAAC;AAAA,IACmD;AAAA,IAGhE,MAAM;AACF,UAAI,CAAC,KAAK;AAAQ,eAAO,KAAK,GAAG;AACjC,WAAK,SAAS;AACd,WAAK,SAAS;AACd,qBAAe;AAEf,oBAAc,IAAI;AAClB,YAAM,IAAI,KAAK,GAAG;AAClB,qBAAe,KAAK;AACpB,aAAO;AAAA,IACX;AAAA,IAEA,OAAO;AACH,WAAK,SAAS;AACd,oBAAc,IAAI;AAAA,IACtB;AAAA,EACJ;AAEA,yBAAuB,SAAwB;AAC3C,YAAO,KAAK,QAAQ,CAAC,QAA6B;AAC9C,UAAI,OAAO,OAAM;AAAA,IACrB,CAAC;AACD,YAAO,KAAK,SAAS;AAAA,EACzB;AAGO,kBAAgB,IAAc,UAA+B,CAAC,GAAG;AACpE,UAAM,UAAU,IAAI,eAAe,IAAI,QAAQ,SAAS;AACxD,YAAQ,IAAI;AACZ,UAAM,SAAc,QAAQ,IAAI,KAAK,OAAO;AAC5C,WAAO,SAAS;AAChB,WAAO;AAAA,EACX;;;ACvCA,MAAM,QAAQ,oBAAI,QAAQ;AACnB,oBAAkB,QAA6B;AAClD,QAAI,MAAM,IAAI,MAAM;AAAG,aAAO,MAAM,IAAI,MAAM;AAE9C,QAAI,OAAO,aAAa;AAEpB,aAAO;AAAA,IACX;AAEA,UAAM,QAAQ,IAAI,MAAM,QAAQ;AAAA,MAC5B,IAAI,SAAQ,KAAK,UAAU;AACvB,YAAI,QAAQ,eAAe;AACvB,iBAAO;AAAA,QACX;AACA,cAAM,SAAQ,GAAG;AACjB,eAAO,QAAQ,IAAI,SAAQ,KAAK,QAAQ;AAAA,MAC5C;AAAA,MACA,IAAI,SAAQ,KAAK,OAAO,UAAU;AAC9B,YAAI,KAAK,QAAQ,IAAI,SAAQ,KAAK,OAAO,QAAQ;AACjD,gBAAQ,SAAQ,GAAG;AACnB,eAAO;AAAA,MAEX;AAAA,IACJ,CAAC;AAED,UAAM,IAAI,QAAQ,KAAK;AAEvB,WAAO;AAAA,EACX;AAEA,MAAM,MAAM,oBAAI,QAAQ;AACxB,iBAAe,QAA6B,KAAsB;AAC9D,QAAI,SAAS,IAAI,IAAI,MAAM;AAC3B,QAAI,CAAC,QAAQ;AACT,UAAI,IAAI,QAAQ,SAAS,oBAAI,IAAI,CAAC;AAAA,IACtC;AAEA,QAAI,OAAO,OAAO,IAAI,GAAG;AACzB,QAAI,CAAC,MAAM;AACP,aAAO,IAAI,KAAK,OAAO,oBAAI,IAAI,CAAC;AAAA,IACpC;AAEA,QAAI,CAAC,KAAK,IAAI,YAAY,GAAG;AACzB,WAAK,IAAI,YAAY;AAAA,IACzB;AACA,oBAAgB,aAAa,KAAK,KAAK,IAAI;AAAA,EAE/C;AAGA,mBAAiB,QAA6B,KAAsB;AAChE,UAAM,SAAS,IAAI,IAAI,MAAM;AAC7B,QAAI,CAAC;AAAQ;AACb,UAAM,OAAO,OAAO,IAAI,GAAG;AAC3B,QAAI,CAAC;AAAM;AACX,QAAI,IAAI,IAAI,EAAE,QAAQ,CAAC,QAAa;AAChC,UAAI,IAAI,WAAW;AACf,YAAI,UAAU;AAAA,MAClB,OAAO;AACH,YAAI,IAAI;AAAA,MACZ;AAAA,IACJ,CAAC;AAAA,EAEL;",
  "names": []
}
